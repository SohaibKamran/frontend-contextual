<app-pagetitle title="Add New TV Episode" [breadcrumbItems]="breadCrumbItems">
  <p></p>
</app-pagetitle>
<div class="row movie-episode">
  <div class="col-12">
    <div class="progress" *ngIf="progress">
      <div class="progress-bar" [style.width]="progress + '%'">{{progress}}%</div>
    </div>
    <div class="card">
      <div class="card-body">
        <form [formGroup]="newEpisodeForm">
          <div class="row">
            <div class="col-lg-6 mt-3">
              <div class="card">
                <div class="card-body">
                  <div class="col-lg-12 mb-3 height-alert1">
                    <div class="row mt-3 align-items-center">
                      <div class="col-lg-3">
                        <label for="example-text-input">Series Name</label>
                      </div>
                      <div class="col-lg-9">
                        <!-- <input formControlName="seriesName" placeholder="Select or add name" class="form-control" type="text"
                                                                      id="example-text-input"> -->
                        <!-- <select formControlName="series" class="form-select" (change)="selectSeries($event.target)">
                          <option value="" disabled>Select Series</option>
                          <option *ngFor="let type of seriesNames" [value]="type?.id">{{type?.title}}</option>
                        </select> -->

                        <!-- <div class="btn-group w-100 position-relative" ngbDropdown id="example-text-input">
                          <input formControlName="series"
                            class="btn btn-outline-secondary d-flex dropdown-toggle justify-content-between"
                            ngbDropdownToggle type="button">
                          <i class="bi bi-caret-down-fill ms-2 fs-md text-gray"></i>
                          <div class="dropdown-menu" ngbDropdownMenu class="scroll" scrollTracker (scrolled)="onSeriesScrollEnd($event)">
                            <a class="dropdown-item text-success" (click)="openAddSeriesModal()">+Add Series</a>
                            <a class="dropdown-item" *ngFor="let series of seriesNames;let i= index"
                              (click)="selectSeries(series)">{{series.title}}
                            </a>
                          </div>
                        </div> -->
                        <!-- <ng-select formControlName="series" placeholder="Select Series" [items]="seriesNames"
                          bindLabel="title" [closeOnSelect]="true" (scrollToEnd)="onSeriesScrollEnd($event)"
                          [clearable]="false" (change)="selectSeries($event)">
                          <ng-template ng-header-tmp>
                            <a (click)="openAddSeriesModal()" class="text-success">+ Add New Series</a>
                          </ng-template>
                        </ng-select> -->
                        <ng-select formControlName="series" placeholder="Select Series" [items]="seriesNames"
                          bindLabel="title" [closeOnSelect]="true" (scrollToEnd)="onSeriesScrollEnd($event)"
                          [clearable]="seriesLoader?false:true" (change)="selectSeries($event)" (search)="searchSeries($event)"
                          [loading]="seriesLoader" (clear)="clearSeries()">
                          <ng-template ng-header-tmp>
                            <a (click)="openAddSeriesModal()" class="text-success">+ Add New Series</a>
                          </ng-template></ng-select>
                      </div>
                    </div>
                    <div class="row">
                      <span
                        *ngIf="newEpisodeForm.get('series').touched &&newEpisodeForm.get('series')?.value=='Add Series'"
                        style="color:red; font-size: 10px;" class="col-lg-9 d-block ms-auto mt-1">
                        Series is required
                      </span>
                    </div>
                  </div>
                  <div class="col-lg-12 mb-3 height-alert2">
                    <div class="row align-items-center">
                      <div class="col-lg-2">
                        <label for="example-text-input">Season</label>
                      </div>
                      <div class="col-lg-4">
                        <input formControlName="season" (keypress)="CheckNumber($event)" class="form-control"
                          placeholder="season" type="text">
                        <!-- <select formControlName="season" class="form-select">
                          <option disabled selected value="">Select</option>
                          <option [value]="1">1-10</option>
                          <option [value]="2">1-20</option>
                          <option [value]="3">1-30</option>
                          <option [value]="4">1-40</option>
                        </select> -->
                      </div>
                      <div class="col-lg-2">
                        <label for="example-text-input">Episode</label>
                      </div>
                      <div class="col-lg-4">
                        <input formControlName="episode" (keypress)="CheckNumber($event)" class="form-control"
                          placeholder="Episode" type="text">
                        <!-- <select formControlName="episode" class="form-select">
                          <option disabled selected value="">Select</option>
                          <option [value]="5">1-10</option>
                          <option [value]="6">1-20</option>
                          <option [value]="7">1-30</option>
                          <option [value]="8">1-40</option>
                        </select> -->
                      </div>
                    </div>
                    <div class="row">
                      <span
                        *ngIf="newEpisodeForm.get('season').touched && newEpisodeForm.get('season').hasError('required')"
                        style="color:red; font-size: 10px;" class="col-lg-4 d-block mt-1 offset-lg-2">
                        Season is required
                      </span>
                      <span
                        *ngIf="newEpisodeForm.get('episode').touched && newEpisodeForm.get('episode').hasError('required')"
                        style="color:red; font-size: 10px;" class="col-lg-4 d-block ms-auto mt-1 offset-lg-2">
                        Episode is required
                      </span>
                    </div>
                  </div>
                  <div class="col-lg-12 mb-3 height-alert3">
                    <div class="row align-items-center">
                      <div class="col-lg-4">
                        <label for="example-text-input">Air Date: Month</label>
                      </div>
                      <div class="col-lg-3">
                        <!-- <input formControlName="season" class="form-control" type="text"
                                                                      id="example-text-input"> -->
                        <select formControlName="month" class="form-select">
                          <option value="">month</option>
                          <option [value]="1">1</option>
                          <option [value]="2">2</option>
                          <option [value]="3">3</option>
                          <option [value]="4">4</option>
                          <option [value]="5">5</option>
                          <option [value]="6">6</option>
                          <option [value]="7">7</option>
                          <option [value]="8">8</option>
                          <option [value]="9">9</option>
                          <option [value]="10">10</option>
                          <option [value]="11">11</option>
                          <option [value]="12">12</option>
                        </select>
                      </div>
                      <div class="col-lg-2">
                        <label for="example-text-input">Year</label>
                      </div>
                      <div class="col-lg-3">
                        <!-- <input formControlName="year" class="form-control" type="text"
                                                                      id="example-text-input"> -->
                        <select formControlName="year" id="ddlYears" class="form-select">
                          <option value="">Year</option>
                        </select>
                      </div>
                    </div>
                    <div class="row">
                      <span
                        *ngIf="newEpisodeForm.get('month').touched &&newEpisodeForm.get('month').hasError('required')"
                        style="color:red; font-size: 10px;" class="col-lg-3 d-block mt-1 offset-lg-4">
                        Month is required
                      </span>
                      <span
                        *ngIf="newEpisodeForm.get('year').touched && newEpisodeForm.get('year').hasError('required')"
                        style="color:red; font-size: 10px;" class="col-lg-3 d-block mt-1 offset-lg-2 ms-auto">
                        Year is required
                      </span>
                    </div>
                  </div>

                  <div class="col-lg-12 mb-3 height-alert4">
                    <div class="row">
                      <div class="mb-2">
                        <label for="example-text-input">Episode Title</label>
                      </div>
                      <div>
                        <input formControlName="episodeTitle" placeholder="Enter Title" class="form-control" type="text"
                          (keyup)="trimSpaces($event)" name="episodeTitle">
                        <span
                          *ngIf="newEpisodeForm.get('episodeTitle').touched&&newEpisodeForm.get('episodeTitle').hasError('required')"
                          style="color:red; font-size: 10px;" class="col-lg-12 d-block mt-1">
                          Episode Title is required
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-12 height-alert5">
                    <div class="row">
                      <div class="mb-2">
                        <label for="example-text-input">Episode Description</label>
                      </div>
                      <div>
                        <!-- <input formControlName="series" placeholder="Select or add name" class="form-control" type="text"
                                                                      id="example-text-input"> -->
                        <textarea formControlName="episodeDescription" placeholder="Enter Description"
                          class="form-control" rows="5" (keyup)="trimSpaces($event)"
                          name="episodeDescription"></textarea>
                        <span
                          *ngIf="newEpisodeForm.get('episodeDescription').touched &&newEpisodeForm.get('episodeDescription').hasError('required')"
                          style="color:red; font-size: 10px;" class="col-lg-12 d-block  mt-1">
                          Description is required
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-6 mt-3">
              <div class="card">
                <div class="card-body">
                  <div class="row my-3 align-items-center">
                    <div class="col-md-6">
                      <h6 class="fs-lg fw-regular">Upload Episode Keyframe</h6>
                      <p class="mb-0 text-light fs-lg fw-regular">(1920x1080)</p>

                    </div>
                    <div class="col-md-6">
                      <label *ngIf="!keyFrame" for="keyFrame" class="btn upload-div">
                        <i class="bi bi-plus-lg mb-2"></i>
                        <p class="text-gray mb-0">Upload</p>
                      </label>
                      <label *ngIf="keyFrame" for="keyframe" class="media-div">
                        <img [src]="keyFrame" class="img-thumbnail-tv">
                        <div class="delete-button fs-3 mt-1 text-center text-gray">
                          <i class="bi bi-x-circle-fill" (click)="removeImage('keyFrame')"></i>
                        </div>
                      </label>
                      <input type="file" style="visibility:hidden; display: none;" accept="image/jpeg,
                      image/jpg,
                      image/png,
                      image/gif,
                      image/svg+xml,
                      image/svg,
                      image/webp" id="keyFrame" #keyframe (change)="showImage($event,'keyFrame')" />
                      <span *ngIf="keyFrame===null" style="color:red; font-size: 10px;"
                        class="col-lg-9 d-block ms-auto mt-1">Movie Keyframe is
                        required</span>
                    </div>
                  </div>
                  <hr>
                  <div class="row my-3 align-items-center">
                    <div class="col-md-6">
                      <h6 class="fs-lg fw-regular">Upload Video File</h6>
                      <p class="mb-0 text-light fs-lg fw-regular">(.MOV, .MPEG4, .MP4, .AVI)</p>
                    </div>
                    <div class="col-md-6">
                      <label *ngIf="!movieThumbnail" for="video" class="btn upload-div">
                        <i class="bi bi-plus-lg mb-2"></i>
                        <p class="text-gray mb-0">Upload</p>
                      </label>
                      <label *ngIf="movieThumbnail" for="video" class="media-div">
                        <img [src]="movieThumbnail" class="img-thumbnail-tv">
                        <div class="delete-button fs-3 mt-1 text-center text-gray">
                          <i class="bi bi-x-circle-fill" (click)="removeImage('video')"></i>
                        </div>
                      </label>
                      <input type="file" style="visibility:hidden; display: none;" accept="video/mp4,
                        video/ogg,
                        video/webm,
                        video/3gpp,
                        video/3gpp2,
                        video/quicktime,
                        video/x-matroska,
                        video/mkv,
                        video/*" id="video" (change)="showImage($event,'video')" #video />
                      <span *ngIf="movieThumbnail===null" style="color:red; font-size: 10px;"
                        class="col-lg-9 d-block ms-auto mt-1">Episode file is
                        required</span>
                    </div>
                  </div>
                  <hr>
                  <div class="col-lg-12 mb-3">
                    <div class="row">
                      <div class="mb-2">
                        <label for="example-text-input">Assign Annotator</label>
                      </div>
                      <div class="col-lg-7">
                        <!-- <input formControlName="assignTagger" placeholder="Enter Title" class="form-control" type="text"
                                                          id="example-text-input"> -->
                        <!-- <ng-multiselect-dropdown formControlName="tagger" class="dropdown-select mb-3"
                          [placeholder]="'Select Annotators(s)'" [settings]="dropDownSettings" [data]="tagger"
                          (onSelect)="selectTagger($event)" (onDeSelectAll)="removeAllTaggers($event)"
                          (onDeSelect)="removeTagger($event)" (onSelectAll)="selectAllTaggers($event)">
                        </ng-multiselect-dropdown> -->
                        <ng-select formControlName="tagger" placeholder="Assign Annotator(s)" [items]="tagger"
                          bindLabel="fullName" [multiple]="true" [closeOnSelect]="false" (change)="selectTagger($event)"
                          (scrollToEnd)="onTaggerScrollEnd($event)" (search)="searchTagger($event)"
                          [loading]="taggerLoader" (clear)="clearSearch()">
                          <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index"
                            let-search="searchTerm">
                            <input id="item-{{index}}" type="checkbox" [checked]="item$.selected" />
                            {{item.fullName }}
                          </ng-template>
                          <ng-template ng-multi-label-tmp let-items="items">
                            <div class="ng-value" *ngFor="let item of items.slice(0,1)">
                              {{item.fullName}}
                            </div>
                            <div class="ng-value" *ngIf="items.length > 1">
                              <span class="ng-value-label">+{{items.length - 1}} </span>
                            </div>
                          </ng-template>
                        </ng-select>
                        <!-- <h3>{{progress}}</h3> -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div style="text-align: right;">
              <button type="button" class="btn btn-outline-secondary" routerLink="/videos"> Cancel
              </button>
              <!-- <button type="button" class="text-danger btn btn-light" routerLink="/videos">Cancel</button> -->
              &nbsp;
              <button [disabled]="!newEpisodeForm.valid || formSubmitted" type="button" class="btn btn-primary text-center"
                (click)="SubmitEpisode()"> Add new episode
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>